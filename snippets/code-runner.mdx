export const CodeRunner = (props) => {
  const code = props.code;
  const language = props.language || "bash";
  const filename = props.filename;
  
  const copyToClipboard = async (text) => {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        throw new Error("Clipboard API not available");
      }
    } catch (err) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
      } catch (execErr) {
        console.error("Copy failed:", execErr);
      }
      
      document.body.removeChild(textArea);
    }
  };

  const runCode = async () => {
    await copyToClipboard(code);
    try {
      window.location.href = 'kmtrigger://macro=web_2_terminal';
    } catch (err) {
      console.error("Could not trigger kmtrigger URL scheme:", err);
    }
  };

  const copyCode = async (event) => {
    event.preventDefault();
    await copyToClipboard(code);
    
    const button = event.currentTarget;
    const originalText = button.innerHTML;
    button.innerHTML = 'Copied!';
    
    setTimeout(() => {
      button.innerHTML = originalText;
    }, 2000);
  };

  if (typeof document === "undefined") {
    return null;
  }

  return (
    <div style={{ 
      margin: "20px 0",
      backgroundColor: "#1a1a1a",
      borderRadius: "8px",
      overflow: "hidden"
    }}>
      <div style={{
        display: "flex",
        alignItems: "center",
        justifyContent: "space-between",
        padding: "8px 16px",
        backgroundColor: "#2a2a2a",
        borderBottom: "1px solid #444"
      }}>
        {filename && (
          <span style={{ fontSize: "14px", color: "#ccc" }}>{filename}</span>
        )}
        <div style={{ display: "flex", gap: "8px", marginLeft: "auto" }}>
          <button
            onClick={copyCode}
            style={{
              display: "flex",
              alignItems: "center",
              gap: "4px",
              padding: "4px 12px",
              fontSize: "12px",
              color: "#ccc",
              backgroundColor: "transparent",
              border: "1px solid #555",
              borderRadius: "4px",
              cursor: "pointer"
            }}
            title="Copy code"
          >
            Copy
          </button>
          <button
            onClick={runCode}
            style={{
              display: "flex",
              alignItems: "center", 
              gap: "4px",
              padding: "4px 12px",
              fontSize: "12px",
              color: "white",
              backgroundColor: "#22c55e",
              border: "none",
              borderRadius: "4px",
              cursor: "pointer"
            }}
            title="Copy code and run in terminal"
          >
            Run
          </button>
        </div>
      </div>
      
      <div>
        <pre style={{ 
          padding: "16px", 
          fontSize: "14px", 
          color: "#f1f1f1", 
          overflowX: "auto",
          margin: "0",
          backgroundColor: "#1a1a1a"
        }}>
          <code>{code}</code>
        </pre>
      </div>
    </div>
  );
}; 